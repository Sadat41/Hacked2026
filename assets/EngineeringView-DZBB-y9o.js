import{a as k,j as e}from"./index-BlNojJv3.js";import{u as K,S as U,a as Y}from"./SiteInputPanel-CaDNHYuF.js";import{R as X,B as J,C as Z,X as ee,Y as se,T as ae,L as ie,a as I}from"./BarChart-CcXcHdcP.js";import"./with-selector-BrHPnG2Y.js";const d=[5,10,15,30,60,120,360,720,1440],ne=[2,5,10,25,50,100],le={2:[65.5,45.4,36,23.7,15.4,9.91,4.9,3.13,2],5:[98.2,67.7,53.5,35.1,22.7,14.5,7.12,4.53,2.88],10:[119.9,82.6,65.2,42.7,27.5,17.6,8.62,5.48,3.48],25:[147.1,101.1,79.7,52.1,33.5,21.4,10.4,6.62,4.19],50:[167.4,115,90.6,59.2,38.1,24.3,11.8,7.49,4.75],100:[187.5,128.7,101.4,66.2,42.5,27.1,13.2,8.35,5.29]},E=.95,ce=.9,re=.25,te=.4,de=.3,_=[75,100,125,150,200,250,300,375,450,525,600,750,900],P={sand:{label:"Sand",rate:120,desc:"High infiltration — sandy river valley deposits"},sandyLoam:{label:"Sandy Loam",rate:30,desc:"Moderate-high — mixed alluvial soils"},siltLoam:{label:"Silt Loam",rate:12,desc:"Moderate — typical lowland areas"},clayLoam:{label:"Clay Loam",rate:6,desc:"Low — glacial lacustrine deposits"},clay:{label:"Clay (Glacial Till)",rate:2,desc:"Very low — typical Edmonton uplands"}};function oe(s,r){const c=le[r];if(!c)return 0;if(s<=d[0])return c[0];if(s>=d[d.length-1])return c[c.length-1];for(let l=0;l<d.length-1;l++)if(s>=d[l]&&s<=d[l+1]){const i=Math.log(s),o=Math.log(d[l]),h=Math.log(d[l+1]),m=Math.log(c[l]),M=Math.log(c[l+1]),j=(i-o)/(h-o);return Math.exp(m+j*(M-m))}return c[0]}function he(s){const r=Math.sqrt(s)*1.4,l=.0195*Math.pow(r,.77)*Math.pow(.02,-.385);return Math.max(5,Math.min(l,30))}function A(s,r,c,l,i){let o=E,h=ce;i.greenRoof&&(o=.5*te+.5*E),i.permeablePavement&&(h=de);let m=(o*s+h*r+re*c)/l;return i.rainGarden&&(m*=.85),Math.max(.1,Math.min(m,.95))}function B(s){return s<=0?0:Math.pow(s*.013*10.079/(Math.PI*Math.sqrt(.005)),.375)*1e3}function T(s){for(const r of _)if(r>=s)return r;return _[_.length-1]}function me({lotSize:s,buildingArea:r,address:c,zoningPaveFrac:l}){const[i,o]=k.useState({greenRoof:!1,rainGarden:!1,permeablePavement:!1,bioswale:!1}),[h,m]=k.useState("clay"),M=l?Math.round(l*100):15,[j,G]=k.useState(M);if(!s||s<=0)return e.jsx("div",{className:"dc-empty",children:e.jsx("p",{children:"Lot size data is required for drainage analysis."})});const u=Math.min(r||0,s*.85),f=s*(j/100),N=Math.max(0,s-u-f),Q=(u+f)/s,t=he(s),g=A(u,f,N,s,{greenRoof:!1,rainGarden:!1,permeablePavement:!1}),b=A(u,f,N,s,i),D=s/1e4,v=k.useMemo(()=>ne.map(a=>{const p=oe(t,a);let R=g*p*D/360,w=b*p*D/360;i.bioswale&&(w*=.8);const $=T(B(R)),H=T(B(w)),S=p*(t/60),z=g*S*s/1e3;let F=b*S*s/1e3;return i.bioswale&&(F*=.8),{rp:a,i:p,Q_base:R,Q_lid:w,pipe_base:$,pipe_lid:H,vol_base:z,vol_lid:F}}),[t,g,b,D,i.bioswale,s]),y=P[h],V=y.rate*(t/60),L=y.rate*(t/60)*N/1e3,n=v.find(a=>a.rp===100)??v[v.length-1],x=i.greenRoof||i.rainGarden||i.permeablePavement||i.bioswale,O=x&&n?(1-n.Q_lid/n.Q_base)*100:0,W=v.map(a=>({name:`${a.rp}-yr`,Baseline:+(a.Q_base*1e3).toFixed(2),"With LID":+(a.Q_lid*1e3).toFixed(2)})),q={background:"#0a150a",border:"1px solid rgba(57,211,83,0.35)",borderRadius:2,color:"#39d353",fontSize:11,fontFamily:"'Share Tech Mono', monospace"};function C(a){o(p=>({...p,[a]:!p[a]}))}return e.jsxs("div",{className:"dc",children:[e.jsxs("div",{className:"dc-header",children:[e.jsx("h3",{className:"dc-title",children:"Engineering Analysis"}),e.jsxs("span",{className:"dc-subtitle",children:["Drainage & Site Hydrology — ",c]})]}),e.jsxs("div",{className:"dc-section",children:[e.jsx("h4",{className:"dc-section-label",children:"Site Hydrology"}),e.jsxs("div",{className:"dc-stat-grid",children:[e.jsxs("div",{className:"dc-stat highlight",children:[e.jsxs("span",{className:"dc-stat-value",children:[s.toLocaleString()," m²"]}),e.jsx("span",{className:"dc-stat-label",children:"Lot Area"})]}),e.jsxs("div",{className:"dc-stat highlight",children:[e.jsxs("span",{className:"dc-stat-value",children:[u.toLocaleString()," m²"]}),e.jsx("span",{className:"dc-stat-label",children:"Building Area"})]}),e.jsxs("div",{className:"dc-stat",children:[e.jsxs("span",{className:"dc-stat-value",children:[(Q*100).toFixed(0),"%"]}),e.jsx("span",{className:"dc-stat-label",children:"Impervious Ratio"})]}),e.jsxs("div",{className:"dc-stat",children:[e.jsx("span",{className:"dc-stat-value",children:g.toFixed(2)}),e.jsx("span",{className:"dc-stat-label",children:"Runoff Coeff (C)"})]}),e.jsxs("div",{className:"dc-stat",children:[e.jsxs("span",{className:"dc-stat-value",children:[t.toFixed(1)," min"]}),e.jsxs("span",{className:"dc-stat-label",children:["t",e.jsx("sub",{children:"c"})," (Kirpich)"]})]}),e.jsxs("div",{className:"dc-stat",children:[e.jsxs("span",{className:"dc-stat-value",children:[N.toFixed(0)," m²"]}),e.jsx("span",{className:"dc-stat-label",children:"Pervious Area"})]})]}),e.jsxs("div",{className:"dc-control-row",children:[e.jsxs("label",{className:"dc-control-label",children:["Pavement %",e.jsx("input",{type:"range",min:"0",max:"40",step:"1",value:j,onChange:a=>G(+a.target.value),className:"dc-range"}),e.jsxs("span",{className:"dc-range-val",children:[j,"%"]})]}),e.jsxs("label",{className:"dc-control-label",children:["Soil Type",e.jsx("select",{value:h,onChange:a=>m(a.target.value),className:"dc-select",children:Object.keys(P).map(a=>e.jsx("option",{value:a,children:P[a].label},a))})]})]}),e.jsxs("p",{className:"dc-soil-desc",children:[y.desc," — Infiltration rate: ",e.jsxs("strong",{children:[y.rate," mm/hr"]})," ","(",V.toFixed(1)," mm during t",e.jsx("sub",{children:"c"}),","," ",L.toFixed(2)," m³ absorbed on pervious area)"]})]}),e.jsxs("div",{className:"dc-section",children:[e.jsx("h4",{className:"dc-section-label",children:"Design Storms — Rational Method (Q = CiA)"}),e.jsxs("p",{className:"dc-note",children:["IDF data: verified for Edmonton (ECCC Stn 3012216) · Duration = t",e.jsx("sub",{children:"c"})," = ",t.toFixed(1)," min"]}),e.jsx("div",{className:"dc-table-wrap",children:e.jsxs("table",{className:"dc-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Return Period"}),e.jsx("th",{children:"Intensity (mm/hr)"}),e.jsx("th",{children:"Q (L/s)"}),e.jsx("th",{children:"Pipe (mm)"}),e.jsx("th",{children:"Volume (m³)"})]})}),e.jsx("tbody",{children:v.map(a=>e.jsxs("tr",{className:a.rp===100?"dc-row-highlight":"",children:[e.jsxs("td",{children:[a.rp,"-yr"]}),e.jsx("td",{children:a.i.toFixed(1)}),e.jsx("td",{children:(a.Q_base*1e3).toFixed(2)}),e.jsx("td",{children:a.pipe_base}),e.jsx("td",{children:a.vol_base.toFixed(2)})]},a.rp))})]})})]}),e.jsxs("div",{className:"dc-section",children:[e.jsx("h4",{className:"dc-section-label",children:"LID Simulator — Low Impact Development"}),e.jsx("p",{className:"dc-note",children:"Toggle green infrastructure to see how it reduces peak runoff and required pipe sizing."}),e.jsxs("div",{className:"dc-lid-grid",children:[e.jsxs("label",{className:`dc-lid-card ${i.greenRoof?"on":""}`,children:[e.jsx("input",{type:"checkbox",checked:i.greenRoof,onChange:()=>C("greenRoof")}),e.jsx("div",{className:"dc-lid-icon",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M17 8c.7-1 1-2.2 1-3.5C18 2.6 16.4 1 14.5 1c-.5 0-1 .1-1.4.3C12.4.5 11.5 0 10.5 0 8.6 0 7 1.6 7 3.5c0 .6.1 1.1.3 1.6"}),e.jsx("path",{d:"M12 22V8"}),e.jsx("rect",{x:"4",y:"18",width:"16",height:"4",rx:"1",opacity:"0.3"})]})}),e.jsx("span",{className:"dc-lid-name",children:"Green Roof"}),e.jsx("span",{className:"dc-lid-desc",children:"50% of building area · C: 0.95 → 0.40"})]}),e.jsxs("label",{className:`dc-lid-card ${i.rainGarden?"on":""}`,children:[e.jsx("input",{type:"checkbox",checked:i.rainGarden,onChange:()=>C("rainGarden")}),e.jsx("div",{className:"dc-lid-icon",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M12 2C12 2 5 12 5 16a7 7 0 0 0 14 0c0-4-7-14-7-14z"}),e.jsx("path",{d:"M7 19q5-4 10 0"})]})}),e.jsx("span",{className:"dc-lid-name",children:"Rain Garden"}),e.jsx("span",{className:"dc-lid-desc",children:"8% of lot · Captures first-flush runoff (~15%)"})]}),e.jsxs("label",{className:`dc-lid-card ${i.permeablePavement?"on":""}`,children:[e.jsx("input",{type:"checkbox",checked:i.permeablePavement,onChange:()=>C("permeablePavement")}),e.jsx("div",{className:"dc-lid-icon",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2"}),e.jsx("circle",{cx:"8",cy:"8",r:"1",fill:"currentColor",opacity:"0.4"}),e.jsx("circle",{cx:"16",cy:"8",r:"1",fill:"currentColor",opacity:"0.4"}),e.jsx("circle",{cx:"12",cy:"12",r:"1",fill:"currentColor",opacity:"0.4"}),e.jsx("circle",{cx:"8",cy:"16",r:"1",fill:"currentColor",opacity:"0.4"}),e.jsx("circle",{cx:"16",cy:"16",r:"1",fill:"currentColor",opacity:"0.4"})]})}),e.jsx("span",{className:"dc-lid-name",children:"Permeable Pavement"}),e.jsx("span",{className:"dc-lid-desc",children:"Replaces driveway · C: 0.90 → 0.30"})]}),e.jsxs("label",{className:`dc-lid-card ${i.bioswale?"on":""}`,children:[e.jsx("input",{type:"checkbox",checked:i.bioswale,onChange:()=>C("bioswale")}),e.jsx("div",{className:"dc-lid-icon",children:e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M2 18c2-2 4-2 6 0s4 2 6 0 4-2 6 0"}),e.jsx("path",{d:"M2 14c2-2 4-2 6 0s4 2 6 0 4-2 6 0"}),e.jsx("line",{x1:"12",y1:"2",x2:"12",y2:"10"}),e.jsx("path",{d:"M9 5l3-3 3 3"})]})}),e.jsx("span",{className:"dc-lid-name",children:"Bio-swale"}),e.jsx("span",{className:"dc-lid-desc",children:"Vegetated channel · 20% peak attenuation"})]})]}),x&&e.jsxs("div",{className:"dc-lid-results",children:[e.jsxs("div",{className:"dc-lid-result-row",children:[e.jsx("span",{className:"dc-lid-result-label",children:"Adjusted Runoff Coeff"}),e.jsxs("span",{className:"dc-lid-result-value",children:[g.toFixed(2)," → ",e.jsx("strong",{children:b.toFixed(2)})]})]}),e.jsxs("div",{className:"dc-lid-result-row",children:[e.jsx("span",{className:"dc-lid-result-label",children:"100-yr Peak Discharge"}),e.jsxs("span",{className:"dc-lid-result-value",children:[(n.Q_base*1e3).toFixed(2)," → ",e.jsxs("strong",{children:[(n.Q_lid*1e3).toFixed(2)," L/s"]}),e.jsxs("span",{className:"dc-reduction",children:["▼ ",O.toFixed(0),"%"]})]})]}),e.jsxs("div",{className:"dc-lid-result-row",children:[e.jsx("span",{className:"dc-lid-result-label",children:"Required Pipe (100-yr)"}),e.jsxs("span",{className:"dc-lid-result-value",children:[n.pipe_base,"mm → ",e.jsxs("strong",{children:[n.pipe_lid,"mm"]})]})]}),e.jsxs("div",{className:"dc-lid-result-row",children:[e.jsx("span",{className:"dc-lid-result-label",children:"Runoff Volume (100-yr)"}),e.jsxs("span",{className:"dc-lid-result-value",children:[n.vol_base.toFixed(2)," → ",e.jsxs("strong",{children:[n.vol_lid.toFixed(2)," m³"]}),e.jsxs("span",{className:"dc-reduction",children:["▼ ",(n.vol_base-n.vol_lid).toFixed(2)," m³ captured"]})]})]})]})]}),e.jsxs("div",{className:"dc-section",children:[e.jsxs("h4",{className:"dc-section-label",children:["Peak Discharge Comparison ",x?"(Baseline vs. LID)":""]}),e.jsx(X,{width:"100%",height:200,children:e.jsxs(J,{data:W,barGap:2,barCategoryGap:"20%",children:[e.jsx(Z,{strokeDasharray:"3 3",stroke:"rgba(57,211,83,0.12)"}),e.jsx(ee,{dataKey:"name",stroke:"rgba(57,211,83,0.4)",tick:{fontSize:10,fill:"rgba(57,211,83,0.6)"}}),e.jsx(se,{stroke:"rgba(57,211,83,0.4)",tick:{fontSize:10,fill:"rgba(57,211,83,0.6)"},unit:" L/s"}),e.jsx(ae,{contentStyle:q,formatter:a=>[`${a??0} L/s`]}),e.jsx(ie,{wrapperStyle:{fontSize:10,color:"rgba(57,211,83,0.6)"}}),e.jsx(I,{dataKey:"Baseline",fill:"#39d353",radius:[2,2,0,0]}),x&&e.jsx(I,{dataKey:"With LID",fill:"#22d3ee",radius:[2,2,0,0]})]})})]}),e.jsxs("div",{className:"dc-section dc-summary",children:[e.jsx("h4",{className:"dc-section-label",children:"Design Summary"}),e.jsxs("div",{className:"dc-summary-grid",children:[e.jsxs("div",{className:"dc-summary-item",children:[e.jsx("span",{className:"dc-summary-label",children:"Design Storm (100-yr)"}),e.jsxs("span",{className:"dc-summary-value",children:[n.i.toFixed(1)," mm/hr for ",t.toFixed(0)," min"]})]}),e.jsxs("div",{className:"dc-summary-item highlight",children:[e.jsx("span",{className:"dc-summary-label",children:"Min. Storm Pipe"}),e.jsxs("span",{className:"dc-summary-value lg",children:[x?n.pipe_lid:n.pipe_base," mm"]})]}),e.jsxs("div",{className:"dc-summary-item",children:[e.jsx("span",{className:"dc-summary-label",children:"Peak Discharge (Q₁₀₀)"}),e.jsxs("span",{className:"dc-summary-value",children:[((x?n.Q_lid:n.Q_base)*1e3).toFixed(2)," L/s"]})]}),e.jsxs("div",{className:"dc-summary-item",children:[e.jsx("span",{className:"dc-summary-label",children:"Runoff Volume"}),e.jsxs("span",{className:"dc-summary-value",children:[(x?n.vol_lid:n.vol_base).toFixed(2)," m³"]})]}),e.jsxs("div",{className:"dc-summary-item",children:[e.jsx("span",{className:"dc-summary-label",children:"Soil Infiltration Potential"}),e.jsxs("span",{className:"dc-summary-value",children:[L.toFixed(2)," m³ during storm"]})]}),e.jsxs("div",{className:"dc-summary-item",children:[e.jsx("span",{className:"dc-summary-label",children:"Methodology"}),e.jsx("span",{className:"dc-summary-value sm",children:"Rational Method (Q=CiA) · Manning's pipe sizing · Edmonton IDF"})]})]}),e.jsxs("p",{className:"dc-disclaimer",children:[e.jsx("strong",{children:"Real data:"})," Property — Edmonton Open Data API. Soil infiltration — Rawls et al. (1983). Runoff coefficients — standard ranges (Bedient et al., 2019). Manning's n=0.013 (PVC), S=0.5%.",e.jsx("br",{}),e.jsx("strong",{children:"Approximate:"})," IDF intensities are representative of Edmonton — verify against ECCC Engineering Climate Datasets (Stn 3012216) for any real project.",e.jsx("br",{}),e.jsx("strong",{children:"Not for construction"})," — preliminary analysis only."]})]})]})}function ve(){const s=K();return e.jsxs("div",{className:"precip-view",children:[e.jsxs("div",{className:"precip-sidebar eng-sidebar",children:[e.jsxs("div",{className:"precip-sidebar-header",children:[e.jsx("h2",{children:"Site Analysis"}),e.jsx("p",{className:"precip-subtitle",children:"Engineering Hydrology · Drainage Design"})]}),e.jsx(U,{...s}),s.analysisData&&e.jsx(me,{lotSize:s.analysisData.lotSize,buildingArea:s.analysisData.buildingArea,address:s.analysisData.address,zoning:s.analysisData.zoning,zoningImpervious:s.analysisData.zoningImpervious,zoningPaveFrac:s.analysisData.zoningPaveFrac}),!s.analysisData&&!s.searched&&s.mode==="search"&&e.jsx("div",{className:"precip-section",children:e.jsxs("div",{className:"prop-info-card",children:[e.jsxs("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M2 16c1.5-1.5 3-2 4.5-2s3 .5 4.5 2c1.5 1.5 3 2 4.5 2s3-.5 4.5-2"}),e.jsx("path",{d:"M2 12c1.5-1.5 3-2 4.5-2s3 .5 4.5 2c1.5 1.5 3 2 4.5 2s3-.5 4.5-2"}),e.jsx("path",{d:"M12 2v6"}),e.jsx("path",{d:"M9 5l3-3 3 3"})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Engineering Site Analysis"}),e.jsx("p",{children:"Search any Edmonton property or enter custom site dimensions to run a full drainage analysis with IDF curves, Rational Method calculations, and LID simulation."}),e.jsx("p",{children:"Based on CIV E 321 principles: P − R − G − E − T = ΔS"})]})]})}),e.jsxs("div",{className:"precip-section precip-footer-section",children:[e.jsxs("p",{className:"precip-hint",style:{fontSize:11},children:[e.jsx("strong",{children:"Real data:"})," ",e.jsx("a",{href:"https://data.edmonton.ca",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--hg-green)",textDecoration:"none"},children:"Edmonton Open Data"})," "," · Rawls et al. (1983) · Bedient et al. (2019)",e.jsx("br",{}),e.jsx("strong",{children:"Approximate:"})," IDF intensities — verify against"," ",e.jsx("a",{href:"https://climate-change.canada.ca/climate-data/#/short-duration-rainfall-intensity-idf",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--hg-green)",textDecoration:"none"},children:"ECCC IDF tool"})]}),e.jsx("p",{className:"footer-credit",children:"HackED 2026 - University of Alberta"})]})]}),e.jsx(Y,{handleMapClick:s.handleMapClick,markerPos:s.markerPos,visibleMarkers:s.visibleMarkers,selected:s.selected,setSelected:s.setSelected,setClickMarker:s.setClickMarker,clickMarker:s.clickMarker,clickLoading:s.clickLoading,mode:s.mode})]})}export{ve as default};
